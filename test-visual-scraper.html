<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Visual Brand Scraper - Test</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-8">
<div class="max-w-2xl mx-auto">
<div class="bg-white rounded-lg shadow-lg p-6">
<h1 class="text-3xl font-bold text-gray-800 mb-2">üéØ Visual Brand Scraper</h1>
<p class="text-gray-600 mb-6">Test the vision-first onboarding</p>

<!-- URL Input -->
<div class="mb-4">
<label class="block text-sm font-medium text-gray-700 mb-2">Website URL</label>
<input type="url" id="websiteUrl" placeholder="https://stripe.com" 
       class="w-full border border-gray-300 rounded px-4 py-3 text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent">
</div>

<!-- Scan Button -->
<button onclick="scanWebsite()" id="scanBtn" 
        class="w-full bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 disabled:opacity-50 font-medium text-lg">
üîç Scan Website
</button>

<!-- Scanning Animation -->
<div id="scanningAnimation" class="hidden mt-6 p-4 bg-purple-50 rounded-lg border border-purple-200">
<div class="flex items-center gap-3 text-purple-700">
<svg class="animate-spin h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
<circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
<path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
</svg>
<div>
<div class="font-medium" id="scanningStatus">Analyzing website...</div>
<div class="text-sm text-purple-600 mt-1">This takes 8-12 seconds</div>
</div>
</div>
</div>

<!-- Results -->
<div id="scanResults" class="hidden mt-6">
<div class="p-4 bg-green-50 rounded-lg border border-green-200 mb-4">
<div class="text-lg font-medium text-green-700 mb-2">‚úÖ Brand Identity Extracted</div>
<div id="scanResultsContent" class="space-y-3"></div>
</div>

<!-- Raw JSON -->
<details class="mt-4">
<summary class="cursor-pointer text-sm text-gray-600 hover:text-gray-800">View Raw JSON</summary>
<pre id="rawJson" class="mt-2 p-3 bg-gray-50 rounded text-xs overflow-auto max-h-96"></pre>
</details>
</div>

<!-- Error -->
<div id="scanError" class="hidden mt-6 p-4 bg-red-50 rounded-lg border border-red-200">
<div class="text-red-700 font-medium">‚ùå Scan Failed</div>
<div id="errorMessage" class="text-sm text-red-600 mt-1"></div>
</div>
</div>
</div>

<script>
async function scanWebsite() {
const urlInput = document.getElementById('websiteUrl');
const url = urlInput.value.trim();
if (!url) {
alert('Please enter a URL');
return;
}

const btn = document.getElementById('scanBtn');
const animation = document.getElementById('scanningAnimation');
const results = document.getElementById('scanResults');
const error = document.getElementById('scanError');
const resultsContent = document.getElementById('scanResultsContent');
const errorMessage = document.getElementById('errorMessage');
const statusText = document.getElementById('scanningStatus');
const rawJson = document.getElementById('rawJson');

btn.disabled = true;
btn.textContent = '‚è≥ Scanning...';
animation.classList.remove('hidden');
results.classList.add('hidden');
error.classList.add('hidden');

const statusMessages = [
'Launching headless browser...',
'Rendering page...',
'Capturing screenshot...',
'Analyzing visual hierarchy...',
'Detecting brand colors...',
'Identifying typography...',
'Inferring brand archetype...'
];

let messageIndex = 0;
const statusInterval = setInterval(() => {
statusText.textContent = statusMessages[messageIndex];
messageIndex = (messageIndex + 1) % statusMessages.length;
}, 1500);

try {
// Call the Modal function directly via the API
const apiUrl = 'https://rocoloco--mobius-v2-final-fastapi-app.modal.run/v1/brands/scan';

const response = await fetch(apiUrl, {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ url })
});

const data = await response.json();
clearInterval(statusInterval);

if (!response.ok || data.error) {
throw new Error(data.error || 'Scan failed');
}

// Display results
const archetype = data.identity_core?.archetype || 'Unknown';
const confidence = ((data.confidence || 0) * 100).toFixed(0);
const colors = data.colors || [];
const typography = data.typography || [];
const voiceVectors = data.identity_core?.voice_vectors || {};
const visualStyle = data.visual_style || {};

resultsContent.innerHTML = `
<div class="grid grid-cols-2 gap-4">
<div>
<div class="text-sm text-gray-600">Archetype</div>
<div class="text-lg font-semibold text-gray-900">${archetype}</div>
</div>
<div>
<div class="text-sm text-gray-600">Confidence</div>
<div class="text-lg font-semibold text-gray-900">${confidence}%</div>
</div>
</div>

<div class="mt-4">
<div class="text-sm font-medium text-gray-700 mb-2">Brand Colors (${colors.length})</div>
<div class="space-y-2">
${colors.slice(0, 5).map(c => `
<div class="flex items-center gap-3 p-2 bg-white rounded border">
<div class="w-10 h-10 rounded border-2 border-gray-200" style="background-color: ${c.hex}"></div>
<div class="flex-1">
<div class="font-medium text-gray-900">${c.name}</div>
<div class="text-xs text-gray-500">${c.hex} ‚Ä¢ ${c.usage} ‚Ä¢ ${(c.usage_weight * 100).toFixed(0)}% prominence</div>
</div>
</div>
`).join('')}
</div>
</div>

<div class="mt-4">
<div class="text-sm font-medium text-gray-700 mb-2">Typography</div>
<div class="space-y-1">
${typography.map(t => `
<div class="text-sm text-gray-600">‚Ä¢ ${t.family} <span class="text-gray-400">(${t.usage})</span></div>
`).join('')}
</div>
</div>

<div class="mt-4">
<div class="text-sm font-medium text-gray-700 mb-2">Voice Profile</div>
<div class="space-y-2">
${Object.entries(voiceVectors).map(([key, val]) => `
<div class="flex items-center gap-2">
<div class="text-sm text-gray-600 w-20 capitalize">${key}</div>
<div class="flex-1 bg-gray-200 rounded-full h-2">
<div class="bg-purple-600 h-2 rounded-full" style="width: ${(val * 100).toFixed(0)}%"></div>
</div>
<div class="text-sm font-medium text-gray-700 w-12 text-right">${(val * 100).toFixed(0)}%</div>
</div>
`).join('')}
</div>
</div>

<div class="mt-4">
<div class="text-sm font-medium text-gray-700 mb-2">Visual Style</div>
<div class="flex flex-wrap gap-2 mb-2">
${(visualStyle.keywords || []).map(kw => `
<span class="px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs font-medium">${kw}</span>
`).join('')}
</div>
<div class="text-sm text-gray-600">${visualStyle.imagery_style || 'N/A'}</div>
</div>
`;

rawJson.textContent = JSON.stringify(data, null, 2);
results.classList.remove('hidden');
animation.classList.add('hidden');

} catch (e) {
clearInterval(statusInterval);
animation.classList.add('hidden');
errorMessage.textContent = e.message;
error.classList.remove('hidden');
}

btn.disabled = false;
btn.textContent = 'üîç Scan Website';
}

// Allow Enter key to submit
document.getElementById('websiteUrl').addEventListener('keypress', (e) => {
if (e.key === 'Enter') scanWebsite();
});
</script>
</body>
</html>
